window.Kamome=function(n){var e={requestTimeout:"RequestTimeout",rejected:"Rejected",canceled:"Canceled"},t={},i={},r=[],u=!1,a=1e4,o=function(n){return a=n,this},c=function(n,e){return t[n]=e,this},l=function(n){return n in t&&delete t[n],this},d=function(e,t,i,u){return null!==u&&u!==n||(u=a),i?(r.push({id:k(),name:e,data:t,timeout:u,callback:i}),s(),null):new Promise(function(n,i){r.push({id:k(),name:e,data:t,timeout:u,resolve:n,reject:i}),s()})},f=function(n){if(0!==r.length){u=!1;var t=n?":"+n:"";m(function(n){"callback"in n?n.callback(null,e.canceled+":"+n.name+t):"reject"in n&&n.reject(e.canceled+":"+n.name+t)})}},s=function(){if(0!==r.length&&!u){u=!0;var n=r[0],t=JSON.stringify({name:n.name,data:n.data,id:n.id});v()&&"webkit"in window?setTimeout(function(){window.webkit.messageHandlers.kamomeSend.postMessage(t)},0):x()&&"kamomeAndroid"in window?setTimeout(function(){window.kamomeAndroid.kamomeSend(t)},0):n.name in i&&setTimeout(function(){var e=function(n,e){return function(t){h(n,t?JSON.stringify(t):null,e)}}(n.name,n.id),t=function(n,e){return function(t){j(n,t,e)}}(n.name,n.id);i[n.name](n.data,e,t)},0),n.timeout>0&&setTimeout(function(n){return function(){u=!1,r.length>0&&r[0].id===n&&m(function(n){"callback"in n?n.callback(null,e.requestTimeout+":"+n.name):"reject"in n&&n.reject(e.requestTimeout+":"+n.name)})}}(n.id),n.timeout)}},m=function(n){n(r.shift()),s()},x=function(){return navigator.userAgent.toLowerCase().indexOf("android")>0},v=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("iphone")>0||n.indexOf("ipad")>0||n.indexOf("ipod")>0},b=function(n){return"[object Object]"==={}.toString.call(n)},g=function(n){return"[object Function]"==={}.toString.call(n)},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=16*Math.random()|0,t="x"===n?e:3&e|8;return t.toString(16)}).toLowerCase()},w=function(e,t){t=t||{};for(var i in t)null===t[i]||t[i]===n?e[i]=null:b(t[i])?e[i]=w(e[i]||{},t[i]):e[i]=t[i];return e},h=function(n,e){if(u=!1,r.length>0&&r[0].id===e){var t=n?JSON.parse(n):null;m(function(n){"callback"in n?n.callback(t,null):"resolve"in n&&n.resolve(t)})}return null},j=function(n,t){if(u=!1,r.length>0&&r[0].id===t){var i=n?":"+n:"";m(function(n){"callback"in n?n.callback(null,e.rejected+":"+n.name+i):"reject"in n&&n.reject(e.rejected+":"+n.name+i)})}return null},O=function(n,e,i){if(n in t){var r=t[n](e?JSON.parse(e):null);return x()?{callbackId:i,result:r}:JSON.stringify({callbackId:i,result:r})}return x()?{callbackId:i,result:null}:JSON.stringify({callbackId:i,result:null})},S=function(n,e){return i[n]=e,this},p={Error:e,setDefaultRequestTimeout:o,addReceiver:c,removeReceiver:l,send:d,cancelCurrentRequest:f,onComplete:h,onError:j,onReceive:O,addWebHandler:S};return p.extension={addCommand:function(n,e,t){return p[t||n]=function(n,e){return function(t,i,r){var u=g(t)?t(w({},e)):w(w({},e),t);return d(n,u,i,r)}}(n,e),this}},p}();